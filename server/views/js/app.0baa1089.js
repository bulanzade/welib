(function(t){function e(e){for(var n,s,i=e[0],u=e[1],c=e[2],p=0,d=[];p<i.length;p++)s=i[p],Object.prototype.hasOwnProperty.call(o,s)&&o[s]&&d.push(o[s][0]),o[s]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(t[n]=u[n]);l&&l(e);while(d.length)d.shift()();return a.push.apply(a,c||[]),r()}function r(){for(var t,e=0;e<a.length;e++){for(var r=a[e],n=!0,i=1;i<r.length;i++){var u=r[i];0!==o[u]&&(n=!1)}n&&(a.splice(e--,1),t=s(s.s=r[0]))}return t}var n={},o={app:0},a=[];function s(e){if(n[e])return n[e].exports;var r=n[e]={i:e,l:!1,exports:{}};return t[e].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=t,s.c=n,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(r,n,function(e){return t[e]}.bind(null,n));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],u=i.push.bind(i);i.push=e,i=i.slice();for(var c=0;c<i.length;c++)e(i[c]);var l=u;a.push([0,"chunk-vendors"]),r()})({0:function(t,e,r){t.exports=r("56d7")},"034f":function(t,e,r){"use strict";r("85ec")},"56d7":function(t,e,r){"use strict";r.r(e);var n=r("2b0e"),o=r("5c96"),a=r.n(o),s=(r("0fae"),function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"app"}},[r("Navbar"),r("router-view")],1)}),i=[],u=function(){var t=this,e=t.$createElement,r=t._self._c||e;return"/"===t.$route.path||"/myborrowing"===t.$route.path||"/user"===t.$route.path?r("el-menu",{attrs:{mode:"horizontal","default-active":t.$route.path,"active-text-color":"#409EFF",router:""}},[r("el-menu-item",{attrs:{index:"/"}},[t._v("首页")]),r("el-menu-item",{attrs:{index:"/myborrowing"}},[t._v("我的借阅")]),r("el-menu-item",{attrs:{index:"/user"}},[t._v("我")])],1):t._e()},c=[],l={name:"Navbar"},p=l,d=r("2877"),m=Object(d["a"])(p,u,c,!1,null,"4674352e",null),f=m.exports,b={components:{Navbar:f}},g=b,h=(r("034f"),Object(d["a"])(g,s,i,!1,null,null,null)),v=h.exports,w=r("8c4f"),_=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("div",{staticClass:"search-bar"},[r("el-input",{attrs:{"prefix-icon":"el-icon-search",placeholder:"输入书名搜索"},model:{value:t.input,callback:function(e){t.input=e},expression:"input"}}),r("el-button",{attrs:{type:"primary"},on:{click:t.search}},[t._v("搜索")])],1),r("div",{staticClass:"book-list"},t._l(t.books,(function(t){return r("BookCard",{key:t._id,attrs:{_id:t._id,name:t.name,author:t.author,img:t.img,desc:t.desc.substring(0,100)+"……"}})})),1)])},S=[],y=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"book-card"},[r("img",{staticClass:"book-card-image",attrs:{src:t.img}}),r("div",{staticClass:"book-card-text-container"},[r("div",{staticClass:"book-card-title-container"},[r("a",{staticClass:"book-card-title",attrs:{href:t.link}},[t._v(" "+t._s(t.name)+" ")])]),r("div",[r("a",[t._v(t._s(t.author))])]),r("div",{staticClass:"book-card-desc-container"},[r("p",{staticClass:"book-card-desc"},[t._v("   "+t._s(t.desc)+" ")])]),r("el-button",{attrs:{type:"primary"},on:{click:t.borrowBook}},[t._v("借阅")])],1)])},I=[],k=r("bc3a"),E=r.n(k),x=E.a.create({baseURL:"/api",withCredentials:!0});x.interceptors.request.use((function(t){return t}),(function(t){return Promise.reject(t)})),x.interceptors.response.use((function(t){return t}),(function(t){return 504==t.response.status||404==t.response.status?o["Message"].error({message:"服务器被吃了⊙﹏⊙∥"}):403==t.response.status?o["Message"].error({message:"权限不足,请联系管理员!"}):401==t.response.status||t.response.data.msg?o["Message"].error({message:t.response.data.msg}):o["Message"].error({message:"未知错误!"}),t}));var C={name:"BookCard",props:{_id:String,name:String,author:String,img:String,desc:String,link:String},methods:{borrowBook:function(){x.post("/borrow",{book:{_id:this._id,name:this.name},user:{_id:localStorage.getItem("USERID"),name:localStorage.getItem("USERNAME")}}).then((function(t){return t.data.msg||o["Message"].success("借阅成功 "),t}))}}},D=C,O=(r("f501"),Object(d["a"])(D,y,I,!1,null,"70b45d3b",null)),j=O.exports,F={name:"Home",components:{BookCard:j},data:function(){return{input:"",books:[]}},methods:{search:function(){var t=this;""!==this.input&&x.get("/book/"+this.input).then((function(e){0===e.data.length&&o["Message"].warning("未找到相关书籍"),t.books=e.data}))}}},$=F,M=(r("d951"),Object(d["a"])($,_,S,!1,null,"16e0d03c",null)),U=M.exports,N=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"table-container"},[r("el-table",{attrs:{data:t.borrowInfo,"row-class-name":t.rowClassName}},[r("el-table-column",{attrs:{prop:"user.name",label:"借阅人",width:"180"}}),r("el-table-column",{attrs:{prop:"book.name",label:"书名"}}),r("el-table-column",{attrs:{prop:"_borrowDate",label:"借阅日期",width:"200",sortable:""}}),r("el-table-column",{attrs:{prop:"_returnDate",label:"归还日期",width:"200",sortable:""}}),r("el-table-column",{scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-button",{attrs:{type:"primary",size:"mini",disabled:e.row.returnDate&&""!==e.row.returnDate},on:{click:function(r){return t.returnBook(e.$index,e.row)}}},[t._v(" 还书 ")])]}}])})],1)],1)},R=[],B={name:"MyBorrowing",methods:{rowClassName:function(t){var e=t.row;return e.returnDate&&""!==e.returnDate?"success-row":"warning-row"},returnBook:function(t,e){var r=this;this.borrowInfo.splice(t,1),x.put("/borrow",e).then((function(t){t.data._borrowDate=new Date(t.data.borrowDate).toLocaleString(),t.data._returnDate=new Date(t.data.returnDate).toLocaleString(),r.borrowInfo.push(t.data)}))}},data:function(){var t=this;return x.get("/borrow/"+localStorage.getItem("USERID")).then((function(e){e.data.forEach((function(t){t._borrowDate=new Date(t.borrowDate).toLocaleString(),t.returnDate&&(t._returnDate=new Date(t.returnDate).toLocaleString())})),t.borrowInfo=e.data})),{borrowInfo:[]}}},P=B,L=(r("792e"),Object(d["a"])(P,N,R,!1,null,null,null)),T=L.exports,A=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-tabs",{staticClass:"login-in-tabs",attrs:{type:"border-card"}},[r("el-tab-pane",{attrs:{label:"用户登录"}},[r("SignIn")],1)],1)},z=[],H=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-form",{ref:"signInForm",staticClass:"sign-in-form",attrs:{model:t.signInForm,"status-icon":"",rules:t.rules}},[r("el-form-item",{attrs:{prop:"id"}},[r("el-input",{attrs:{placeholder:"请输入账号",type:"text"},model:{value:t.signInForm.account,callback:function(e){t.$set(t.signInForm,"account",t._n(e))},expression:"signInForm.account"}})],1),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{placeholder:"请输入密码",type:"password"},model:{value:t.signInForm.password,callback:function(e){t.$set(t.signInForm,"password",e)},expression:"signInForm.password"}})],1),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitForm("signInForm")}}},[t._v("登录")]),r("el-button",{attrs:{type:"danger"},on:{click:function(e){return t.resetForm("signInForm")}}},[t._v("重置")])],1)],1)},J=[],q={name:"SignIn",data:function(){var t=function(t,e,r){if(!e)return r(new Error("账号不能为空"));setTimeout((function(){Number.isInteger(e)?r():r(new Error("账号必须为数字"))}),100)},e=function(t,e,r){""===e?r(new Error("密码不能为空")):e.length<6||e.length>15?r(new Error("密码长度为 6-15")):r()};return{signInForm:{account:"",password:""},rules:{account:[{validator:t,trigger:"blur"}],password:[{validator:e,trigger:"blur"}]}}},methods:{submitForm:function(t){var e=this;this.$refs[t].validate((function(t){t&&x.post("/login",{account:e.signInForm.account,password:e.signInForm.password}).then((function(t){"SUCCESS"===t.data.state?(localStorage.setItem("USERID",t.data.user._id),localStorage.setItem("USERNAME",t.data.user.name),localStorage.setItem("USERACCOUNT",t.data.user.account),Object(o["Message"])({message:"登陆成功",type:"success"}),it.push("/")):Object(o["Message"])({message:t.data.msg,type:"error"})}))}))},resetForm:function(t){this.$refs[t].resetFields()}}},G=q,K=Object(d["a"])(G,H,J,!1,null,"374952a8",null),Q=K.exports,V={name:"Login",components:{SignIn:Q}},W=V,X=(r("fa92"),Object(d["a"])(W,A,z,!1,null,"2a241e28",null)),Y=X.exports,Z=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("p",[t._v("用户名："+t._s(t.name))]),r("p",[t._v("账号："+t._s(t.account))])])},tt=[],et={name:"User",data:function(){return{name:localStorage.getItem("USERNAME"),account:localStorage.getItem("USERACCOUNT")}}},rt=et,nt=Object(d["a"])(rt,Z,tt,!1,null,"0f023548",null),ot=nt.exports;n["default"].use(w["a"]);var at=[{path:"/",name:"Home",component:U},{path:"/myborrowing",name:"MyBorrowing",component:T},{path:"/login",name:"Login",component:Y},{path:"/user",name:"User",component:ot}],st=new w["a"]({mode:"history",base:"/",routes:at});st.beforeEach((function(t,e,r){"/login"===t.path?localStorage.getItem("USERID")?r("/"):r():localStorage.getItem("USERID")?r():r("/login")}));var it=st;n["default"].config.productionTip=!1,n["default"].use(a.a),new n["default"]({router:it,render:function(t){return t(v)}}).$mount("#app")},5945:function(t,e,r){},"5c6d":function(t,e,r){},"792e":function(t,e,r){"use strict";r("fd3a")},"85ec":function(t,e,r){},"98b6":function(t,e,r){},d951:function(t,e,r){"use strict";r("5c6d")},f501:function(t,e,r){"use strict";r("98b6")},fa92:function(t,e,r){"use strict";r("5945")},fd3a:function(t,e,r){}});
//# sourceMappingURL=app.0baa1089.js.map